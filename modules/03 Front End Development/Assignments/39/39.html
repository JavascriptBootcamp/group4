<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
		table,tr,td,th{
			border:1px solid;
		}
		td,th{
			width:180px;
			height: 30px;
		}
		select{
			width: 100%;
			height: 100%;
		}
		#price{
			width:98%;
			height: 100%;
		}
		button{
			width:100%;
			height: 100%;
		}
	</style>
</head>
<body>
	<table id="shoppingCart">
		<h1>shopping cart table</h1>
		<tr>
			<th>Name</th>
			<th>Price</th>
			<th>Action</th>
		</tr>
		<tr>
			<td>
				<select id="productsName">
					<option>t-shirt</option>
					<option>pants</option>
					<option>socks</option>
					<option>gloves</option>
					<option>jacket</option>
					<option>shoes</option>
					<option>coats</option>
					<option>jeans</option>
					<option>suits</option>
					<option>swimwear</option>
				</select>
			</td>
			<td>
				<input id="price" type="number">
			</td>
			<td>
				<button id="action" onclick="addProduct()">Add</button>
			</td>
		</tr>
	</table>
	<h3>total :</h3>
	<div id="total"></div>

	<h3>payment :</h3>
	<form id="payment" method="post" action="http://localhost:3000/Order" onsubmit="return false">
		<input type="text" id="CardNumber" placeholder="Card Number" required>
		<input type="text" id="NameOnCard" placeholder="Name on card" required>
		<input type="date" id="ExpiryDate" placeholder="Expiry date" required>
		<input type="text" pattern="[0-9]{3}" id="SecurityCode" placeholder="Security code" required>
		<input type="submit" value="submit" onclick="validate()">
	</form>
	<h3>Error : </h3>
	<div id="error"></div>
<script type="text/javascript">
	var sum = 0;
	function addProduct(){
		var name = document.getElementById("productsName").value;
		var price = document.getElementById("price").value;
		var total = document.getElementById("total");
		var shoppingCart = document.getElementById("shoppingCart");
		var cart = {
		name : price
		}
		sum += register(cart);
		total.innerHTML=sum;
		if(name && price){
			var tr = document.createElement("tr");
			var td = document.createElement("td");
			var td2 = document.createElement("td");
			var td3 = document.createElement("td");
			var btn = document.createElement("button");
			td.innerText = name;
			tr.appendChild(td);
			td2.innerText = price;
			tr.appendChild(td2);
			btn.onclick = function(){
				this.parentNode.parentNode.remove();
				sum-=register(cart)
				total.innerHTML=sum;
			}
			btn.innerText = "remove";
			td3.appendChild(btn);
			tr.appendChild(td3);
			shoppingCart.appendChild(tr);
		}
		else{
			return;
		}
	}
	function register(cart){
		var sum = 0;
		for (var key in cart)
		{
			if(cart.hasOwnProperty(key))
			{
			 	sum+=parseFloat(cart[key]);
			}	
		}
		return sum;
	}


	var sumCreditCard;
	function validate(){
		sumCreditCard = 0;
		var CreditCardNumber = document.getElementById("CardNumber").value;
		var NameOnCard = document.getElementById("NameOnCard").value;
		var ExpiryDate = document.getElementById("ExpiryDate").value;
		var SecurityCode = document.getElementById("SecurityCode").value;
		var payment = document.getElementById("payment");
		var error = document.getElementById("error");
		var creditObj = validateCreditCard();
		error.innerText = "";
		console.log(CreditCardNumber);
		if(creditObj.error || !CreditCardNumber || !NameOnCard || !ExpiryDate || !SecurityCode){
			error.innerText = creditObj.error;
		}
		else{
			payment.onsubmit = true;
		}
	}
	function validateCreditCard(){
		var CreditCardNumber = document.getElementById("CardNumber").value;
		var arr = CreditCardNumber.toString().split("-");
		arr = arr.join('').split("");
		var checkNumber;
		var arrWithoutDuplicates = new Array(10).fill(0);
		var NumOfDigitsWithoutDuplicates =0;
		var lastIndex;
		var errorMassage = "";
	    //check duplicates numbers in the array and sum between numbers 
	    NumOfDigitsWithoutDuplicates = CalcNumbersAndCheckDuplicates(arr,arrWithoutDuplicates,NumOfDigitsWithoutDuplicates);
	    lastIndex = arr.length-1;
	    lastIndex = arr[lastIndex];
	    if(NumOfDigitsWithoutDuplicates >= 2 && !isNaN(checkNumber) && arr.length === 16  && lastIndex % 2 ===0 && sumCreditCard > 16 ? true : false) 
	    {
	        var creditObj = {
	            valid : true ,
	            number : checkNumber ,  
	        } 
	        return creditObj;
	    }
	    else{
	        var creditObj = {
	            valid : false ,
	            number : checkNumber , 
	            error : checkError(lastIndex,arr,NumOfDigitsWithoutDuplicates,errorMassage)
	        } 
	        return creditObj;
	    }
	}
	function CalcNumbersAndCheckDuplicates(arr,arrWithoutDuplicates,NumOfDigitsWithoutDuplicates){
	    checkNumber = arr.join('');
	    arr = arr.join('').split("");

	    arr.forEach(function(item,index){
	        sumCreditCard+=Number(item);
	        arrWithoutDuplicates[item]++;
	    });

	    for(var i=0; i<arrWithoutDuplicates.length; i++){ 
	       if(arrWithoutDuplicates[i] >0 ){
	          NumOfDigitsWithoutDuplicates++;
	       }
	    }
	    return NumOfDigitsWithoutDuplicates;
	}

	function checkError(lastIndex,arr,NumOfDigitsWithoutDuplicates,errorMassage){
	    if(NumOfDigitsWithoutDuplicates < 2){
	        errorMassage = "You must have at least two different digits represented";
	    }
	    else if(isNaN(checkNumber)){
	        errorMassage = "all of them must be numbers";
	    }
	    else if(arr.length !== 16){
	        errorMassage = "Number must be 16 digits";
	    }
	    else if(lastIndex % 2 !==0){
	        errorMassage = "The final digit must be even";
	    }
	    else if(sumCreditCard <= 16){
	        errorMassage = "The sum of all the digits must be greater than 16";
	    }
	    return errorMassage;
	}
</script>
</body>
</html>