<html>

<head>
    <title>
        Books | Favorites
    </title>
</head>

<body>
    <div id="inputRow">
        <input type="text" placeholder="Title" id="title_input">
        <input type="text" placeholder="Authors" id="authors_input">
        <input type="text" onfocus="type='date'" placeholder="Published Date" id="published_date_input">
        <input type="text" placeholder="Publishers" id="publishers_input">
        <input type="number" placeholder="Page Count" min="0" id="pagecount_input">
        <input type="text" placeholder="Comments" id="comments_input">
        <button onclick="addBook()">Add</button>
        <select name="" id="ascOrDesc" onchange="sort()">
            <option value="newest to oldest">newest to oldest</option>
            <option value="oldest to newest">oldest to newest</option>
        </select>
    </div>

    <div>
            <h1> My Top Books: </h1>
    </div>
    <div id="contentBooks">
                <h1>Harry Potter 1</h1>
                <h2>J.K.Rolling</h2>
                <h3>1.1.2000</h3>
                <h4>Unknown</h4>
                <h5>250</h5>
                <p>Very good!!!</p>
        
                <h1>Harry Potter 2</h1>
                <h2>J.K.Rolling</h2>
                <h3>1.1.2002</h3>
                <h4>Unknown</h4>
                <h5>300</h5>
                <p>Very good!!!</p>
        
                <h1>Harry Potter 3</h1>
                <h2>J.K.Rolling</h2>
                <h3>1.1.2004</h3>            
                <h4>Unknown</h4>
                <h5>500</h5>
                <p>Very good!!!</p>
        
                <h1>Harry Potter 4</h1>
                <h2>J.K.Rolling</h2>
                <h3>1.1.2006</h3>            
                <h4>Unknown</h4>
                <h5>700</h5>
                <p>Very good!!!</p>
        
                <h1>Harry Potter 5</h1>
                <h2>J.K.Rolling</h2>
                <h3>1.1.2008</h3>                      
                <h4>Unknown</h4>
                <h5>1000</h5>
                <p>Very good!!!</p>

    </div>
</body>

<script>
    var constBooks = new Array();
    var booksDict = {};
    var booksArray = new Array();
    var booksKey = new Array();
    var isAsc = true;

    setConstBooks();
    booksArray = booksArray.concat(constBooks);
    sort(isAsc);

    function Book(title, authors, pDate, publishers, pageCount, comments) {
        this.title = title;
        this.authors = authors;
        this.pDate = pDate;
        this.publishers = publishers;
        this.pageCount = pageCount;
        this.comments = comments;
    }

    // Excecute only on start page
    function setConstBooks(){
        var titles = document.getElementsByTagName('h1');
        var authors = document.getElementsByTagName('h2');
        var pDates = document.getElementsByTagName('h3');
        var publishers = document.getElementsByTagName('h4');
        var pageCounts = document.getElementsByTagName('h5');
        var comments = document.getElementsByTagName('p');

        console.log(authors[0].textContent);

        for(var i=0;i<titles.length;i++){
            var title = titles[i].textContent;
            var _authors = authors[i].textContent;
            console.log(i,titles[i].textContent);
            var pDate = pDates[i].value;
            var _publishers = publishers[i].textContent;
            var pageCount = pageCounts[i].textContent;
            var _comments = comments[i].textContent;

            var book = new Book(title,_authors,pDate,_publishers,pageCount,_comments);
            constBooks.push(book);
            var bookKey= pDate + title;
            booksDict[bookKey] = book;
            booksKey.push(bookKey)
        }
    }

    // onClick event - Add(button)
    function addBook() {

        var title = document.getElementById('title_input').value;
        var authors = document.getElementById('authors_input').value;
        var pDate = document.getElementById('published_date_input').value;
        var publishers = document.getElementById('publishers_input').value;
        var pageCount = document.getElementById('pagecount_input').value;
        var comments = document.getElementById('comments_input').value;

        var book = new Book(title, authors, pDate, publishers, pageCount, comments);
        var bookNode = createBookNode(book);

        //var bookObj = getBookObj(bookNode);
        var name = book.title;
        var publishDate = book.pDate;

        booksDict[publishDate + name] = book;
        booksKey.push(publishDate + name);

        console.log(bookNode,book);

        sort(isAsc);
    }

    // onClick event(select)
    function sort(ascOrDesc) {
        var selected = document.getElementById('ascOrDesc').value;
        isAsc = (selected === 'oldest to newest' ? true : false);
        console.log(isAsc)
        booksKey = booksKey.sort();
        if (!isAsc) {
            booksKey = booksKey.reverse();
        }

        console.log(booksArray);
        clearArray(booksArray);
        booksArray = booksArray.concat(constBooks);

        booksKey.forEach(element => {
            booksArray.push(booksDict[element]);
        });


        console.log(booksArray);

        var divBooksContent = document.getElementById("contentBooks");
        removeChildNodes(divBooksContent);
        fillPage();

    }

    function fillPage() {
        var divBooksContent = document.getElementById("contentBooks");
        booksArray.forEach(element => {
            console.log(element);
            console.log(createBookNode(element));
            divBooksContent.appendChild((createBookNode(element)));
        });

    }

    function createBookNode(book) {
        var divBook = document.createElement("div");
        divBook.id = "book_" + book.title;

        var title_h1 = document.createElement('h1');
        var authors_h2 = document.createElement('h2');
        var pDate_h3 = document.createElement('h3');
        var publishers_h4 = document.createElement('h4');
        var pageCount_h5 = document.createElement('h5');
        var comments_p = document.createElement('p');

        title_h1.innerText = book.title;
        authors_h2.innerText = book.authors;
        pDate_h3.innerText = book.pDate;
        publishers_h4.innerText = book.publishers;
        pageCount_h5.innerText = book.pageCount;
        comments_p.innerText = book.comments;

        divBook.appendChild(title_h1);
        divBook.appendChild(authors_h2);
        divBook.appendChild(pDate_h3);
        divBook.appendChild(publishers_h4);
        divBook.appendChild(pageCount_h5);
        divBook.appendChild(comments_p);
        return divBook

    }

    function getBookObj(bookNode) {

        var title = bookNode.getElementsByTagName('h1')[0].value;
        var authors = bookNode.getElementsByTagName('h2')[0].value;
        var pDate = bookNode.getElementsByTagName('h3')[0].value;
        var publishers = bookNode.getElementsByTagName('h4')[0].value;
        var pageCount = bookNode.getElementsByTagName('h5')[0].value;
        var comments = bookNode.getElementsByTagName('p')[0].value;

        return new Book(title, authors, pDate, publishers, pageCount, comments);
    }

    function clearArray(arr) {
        while (arr.pop());
    }

    function removeChildNodes(node) {
        while (node.hasChildNodes()) {
            node.removeChild(node.lastChild);
        }
    }

</script>

</html>