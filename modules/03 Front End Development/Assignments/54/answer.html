<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .buttons{width:50px;height:50px;margin:5px;}
    </style>
</head>
<body>
    <div id="pre">
        <label for="player1" class="cont_text">player 1:</label>
        <input type="text" name="player1" id="player1TI"  class="cont_text" required maxlength="1" oninput="setStartGameVisibility()"><br>
        <label for="player2"  class="cont_text">player 2:</label>
        <input type="text" name="player2" id="player2TI"  class="cont_text" required maxlength="1" oninput="setStartGameVisibility()"><br><br>

        <div id="style_light">
            <button onclick="setLight()">light</button>
            <button onclick="setDark()">dark</button>
        </div>

    </div>

    <div id="board"> </div>

    <div id="start">
        <button id="strtBtn" onclick="startGame()">Start Game</button>
    </div>

    <div id="turn_id"></div>
    <div id="winner_message"></div>

    <script>
        var combinations = [['12','36','48'],['02','47'],['10','58','46'],['06','45'],['08','26','35'],['28','43'],['30','42','78'],['41','68'],['52','76','40']];
        var symbolPlayer1 = document.getElementById("player1TI").textContent;
        var symbolPlayer2 = document.getElementById("player2TI").textContent;
        currentSymbol = symbolPlayer1;
        var p1SelectedIndexes = '';
        var p2SelectedIndexes = '';
        drawControlls();

        function drawControlls(){
            var board = document.getElementById("board");
            document.body.appendChild(createBR());
            var matrixDiv = document.createElement("div");
            matrixDiv.disabled = true;
            var buttonIndex = 0;
            matrixDiv.align = "center";
            for(var i=0;i<3;i++){
                var trDiv = document.createElement("div");
                for(var j=0;j<3;j++){
                    //var tdDiv = document.createElement("div");
                    var button = document.createElement("button");
                    // button.style.width = "50px";
                    // button.style.height = "50px";
                    // button.style.margin = "5px";
                    button.id = "button" + buttonIndex++;
                    button.disabled = true;
                    button.className = "buttons";
                    trDiv.appendChild(button);
                    //trDiv.appendChild(tdDiv);
                }
                matrixDiv.appendChild(trDiv);
            }
            board.appendChild(matrixDiv);
            board.appendChild(createBR());
            setStartGameVisibility();
            board.appendChild(createBR());
            board.appendChild(createBR());
        }
        function setStartGameVisibility(){
            symbolPlayer1 = document.getElementById("player1TI").value;
            symbolPlayer2 = document.getElementById("player2TI").value;
            var startGameBtn = document.getElementById("strtBtn");
            
            startGameBtn.disabled = !( symbolPlayer1 !== '' && symbolPlayer2 !== '' && symbolPlayer1 !== symbolPlayer2);
        }
        function startGame(){
            var divCurrentTurn = document.getElementById("turn_id");
            currentSymbol = symbolPlayer1;

            divCurrentTurn.innerText = "Turn: " + currentSymbol;
            document.body.appendChild(divCurrentTurn);
            setOnClickButtons();
            p1SelectedIndexes = '';
            p2SelectedIndexes = '';
        }
        function setOnClickButtons(){
            var buttonIndex = 0;
            while(buttonIndex < 9){
                var buttonId = "button" + buttonIndex;
                var button = document.getElementById(buttonId);
                button.onclick = onButtonClick.bind(button,buttonIndex++);
                button.innerText = '';
                button.disabled = false;
            }
        }
        function onButtonClick(index){
            if(currentSymbol === symbolPlayer1){
                p1SelectedIndexes += index;
            }
            else{
                p2SelectedIndexes += index;
            }
            if(this.innerText != ''){
                return;
            }
            this.innerText = currentSymbol;
            this.disabled = true;
            var isWinner = checkForWin(index);
            if(isWinner){
                endGame(currentSymbol);
                disabledAllButtons();
                return;
            }
            currentSymbol = currentSymbol === symbolPlayer1 ? symbolPlayer2: symbolPlayer1;
            var divCurrentTurn = document.getElementById("turn_id");
            divCurrentTurn.innerText = "Turn: " + currentSymbol;
        }
        function checkForWin(index){
            var comb = combinations[index];
            var selectedIndexes = currentSymbol === symbolPlayer1 ? p1SelectedIndexes : p2SelectedIndexes;
            for(var i=0;i<comb.length;i++){
                var c1 = comb[i][0];
                var c2 = comb[i][1];
                if(selectedIndexes.indexOf(c1) !== -1 && selectedIndexes.indexOf(c2) !== -1){
                    return true;
                }
            }
            return false;
        }
        function endGame(winner){
            var winnerMessage = "The Winner is: " + winner + "!!!";
            var divWinner = document.getElementById("winner_message");
            divWinner.innerText = winnerMessage;
            var divTurn = document.getElementById("turn_id");
            divTurn.appendChild(divWinner);
        }
        function disabledAllButtons(){
            var buttonIndex = 0;
            while(buttonIndex < 9){
                var buttonId = "button" + buttonIndex++;
                var button = document.getElementById(buttonId);
                button.disabled = true;
            }
        }
        function createBR(){
            return document.createElement("br");
        }

        function setDark(){
            var body = document.getElementsByTagName("body")[0];
            body.style.color = "#FFF";
            body.style.backgroundColor = "#37383a";
        }

        function setLight(){
            var body = document.getElementsByTagName("body")[0];
            body.style.color = "#000";
            body.style.backgroundColor = "#FFF";
        }

        function hideElementsExceptStart(){
            var pre = document.getElementById("pre");
            var board = document.getElementById("board");

            pre.hidden = true;
            board.hidden = true;
        }

    </script>
</body>
</html>